<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | MiniIA Hub</title>
    <meta name="description" content="Faça login na sua conta no MiniIA Hub para acessar e gerenciar suas mini-IAs.">
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <style>
        :root {
            /* Cores principais */
            --color-primary: #2D9CDB;
            --color-primary-dark: #2188c2;
            --color-secondary: #27AE60;
            --color-secondary-dark: #219653;
            --color-accent: #9B51E0;
            --color-accent-dark: #8A41CC;
            --color-dark: #333333;
            --color-light: #F2F2F2;
            --color-gray: #828282;
            --color-white: #FFFFFF;
            --color-error: #EB5757;
            
            /* Fontes */
            --font-heading: 'Poppins', sans-serif;
            --font-body: 'Inter', sans-serif;
        }

        /* Dark mode */
        .dark-mode {
            --color-primary: #3DB4FF;
            --color-primary-dark: #2D9CDB;
            --color-secondary: #3BCC80;
            --color-secondary-dark: #27AE60;
            --color-accent: #AF72F0;
            --color-accent-dark: #9B51E0;
            --color-dark: #F2F2F2;
            --color-light: #1E1E1E;
            --color-gray: #BDBDBD;
            --color-white: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            font-weight: 400;
            color: var(--color-dark);
            background-color: var(--color-light);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            font-weight: 700;
            line-height: 1.2;
        }

        a {
            text-decoration: none;
            color: var(--color-accent);
            transition: color 0.3s;
        }

        a:hover {
            color: var(--color-accent-dark);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Botões */
        .btn {
            display: inline-block;
            font-weight: 500;
            font-size: 16px;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(45, 156, 219, 0.2);
        }

        .btn-secondary {
            background-color: var(--color-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--color-secondary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(39, 174, 96, 0.2);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
        }

        .btn-outline:hover {
            background-color: var(--color-primary);
            color: white;
        }

        /* Navbar */
        .navbar {
            padding: 20px 0;
            background-color: var(--color-white);
            border-bottom: 1px solid var(--color-light);
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-logo {
            display: flex;
            align-items: center;
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 24px;
            color: var(--color-primary);
        }

        .navbar-logo img {
            height: 36px;
            margin-right: 10px;
        }

        .navbar-logo span {
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: var(--color-gray);
            transition: color 0.3s;
        }

        /* Login */
        .login {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 0;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            background-color: var(--color-white);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin: 0 auto;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .login-header p {
            color: var(--color-gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--color-light);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(45, 156, 219, 0.2);
        }

        .form-check {
            display: flex;
            align-items: center;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .form-check input {
            margin-right: 10px;
        }

        .login-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }

        /* Erro */
        .error-message {
            color: var(--color-error);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            margin-top: 10px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(45, 156, 219, 0.3);
            border-radius: 50%;
            border-top-color: var(--color-primary);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        .footer {
            background-color: var(--color-white);
            padding: 20px 0;
            border-top: 1px solid var(--color-light);
            text-align: center;
            font-size: 14px;
            color: var(--color-gray);
        }

        /* Responsivo */
        @media (max-width: 576px) {
            .login-container {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="../miniaihub.html" class="navbar-logo">
                <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 3C9.716 3 3 9.716 3 18C3 26.284 9.716 33 18 33C26.284 33 33 26.284 33 18C33 9.716 26.284 3 18 3Z" fill="#2D9CDB"/>
                    <path d="M24 13L16 21L12 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 25L10 21L14 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M22 9L26 13L22 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>MiniIA Hub</span>
            </a>
            
            <button class="theme-toggle" aria-label="Alternar modo escuro">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 2V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 20V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4.93 4.93L6.34 6.34" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M17.66 17.66L19.07 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 12H4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20 12H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6.34 17.66L4.93 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19.07 4.93L17.66 6.34" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </nav>

    <!-- Login -->
    <section class="login">
        <div class="container">
            <div class="login-container">
                <div class="login-header">
                    <h1>Acesse sua conta</h1>
                    <p>Entre para gerenciar suas Mini-IAs</p>
                </div>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="email">E-mail</label>
                        <input type="email" id="email" class="form-control" placeholder="Seu e-mail" required>
                        <div class="error-message" id="email-error">Por favor, insira um e-mail válido</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Senha</label>
                        <input type="password" id="password" class="form-control" placeholder="Sua senha" required>
                        <div class="error-message" id="password-error">Por favor, insira sua senha</div>
                    </div>
                    
                    <div class="form-check">
                        <input type="checkbox" id="remember-me">
                        <label for="remember-me">Lembrar de mim</label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Entrar</button>
                    
                    <div class="loading" id="loading">
                        <span class="loading-spinner"></span>
                        <span>Autenticando...</span>
                    </div>
                    
                    <div class="error-message" id="login-error" style="text-align: center; margin-top: 15px;">E-mail ou senha incorretos</div>
                </form>
                
                <div class="login-footer">
                    <p>Não tem conta? <a href="cadastro.html">Cadastre-se</a></p>
                    <p><a href="recuperar-senha.html">Esqueceu a senha?</a></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 MiniIA Hub. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Theme Toggle
        const themeToggle = document.querySelector('.theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            updateThemeIcon();
        });

        function updateThemeIcon() {
            const isDarkMode = document.body.classList.contains('dark-mode');
            themeToggle.innerHTML = isDarkMode ? 
                `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 3C10.8065 4.19347 10.136 5.81217 10.136 7.5C10.136 9.18783 10.8065 10.8065 12 12C13.1935 13.1935 14.8122 13.864 16.5 13.864C18.1878 13.864 19.8065 13.1935 21 12C21 13.78 20.4722 15.5201 19.4832 17.0001C18.4943 18.4802 17.0887 19.6337 15.4442 20.3149C13.7996 20.9961 11.99 21.1743 10.2442 20.8271C8.49836 20.4798 6.89472 19.6226 5.63604 18.364C4.37737 17.1053 3.5202 15.5016 3.17294 13.7558C2.82567 12.01 3.0039 10.2004 3.68509 8.55585C4.36628 6.91131 5.51983 5.50571 6.99987 4.51677C8.47991 3.52784 10.22 3 12 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>` : 
                `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 2V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 20V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4.93 4.93L6.34 6.34" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M17.66 17.66L19.07 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 12H4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20 12H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6.34 17.66L4.93 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19.07 4.93L17.66 6.34" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>`;
        }

        // Utilitários para geração de JWT

        // Função para converter string para Uint8Array
        function stringToUint8Array(str) {
            return new TextEncoder().encode(str);
        }

        // Função para converter Uint8Array para Base64Url
        function uint8ArrayToBase64Url(uint8Array) {
            // Converter Uint8Array para string base64
            const base64 = btoa(String.fromCharCode.apply(null, uint8Array));
            // Converter base64 para base64url
            return base64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
        }

        // Função para gerar uma chave criptográfica a partir da passphrase
        async function generateKey(secret, algorithm) {
            const encodedSecret = stringToUint8Array(secret);
            // Importa a chave usando a WebCrypto API
            return await crypto.subtle.importKey(
                'raw',
                encodedSecret,
                { name: 'HMAC', hash: { name: algorithm } },
                false,
                ['sign']
            );
        }

        // Função principal para gerar JWT
        async function generateJWT(secret, payload) {
            try {
                // Criar o header
                const header = {
                    alg: 'HS512',
                    typ: 'JWT'
                };

                // Codificar header e payload para base64url
                const encodedHeader = uint8ArrayToBase64Url(stringToUint8Array(JSON.stringify(header)));
                const encodedPayload = uint8ArrayToBase64Url(stringToUint8Array(JSON.stringify(payload)));
                
                // Criar a string a ser assinada
                const toSign = encodedHeader + '.' + encodedPayload;
                
                // Gerar a chave a partir do secret
                const key = await generateKey(secret, 'SHA-512');
                
                // Assinar a string
                const signature = await crypto.subtle.sign(
                    'HMAC',
                    key,
                    stringToUint8Array(toSign)
                );
                
                // Codificar a assinatura para base64url
                const encodedSignature = uint8ArrayToBase64Url(new Uint8Array(signature));
                
                // Retornar o JWT completo
                return toSign + '.' + encodedSignature;
            } catch (error) {
                console.error('Erro ao gerar JWT:', error);
                throw error;
            }
        }

        // Form Validation e Login
        const loginForm = document.getElementById('login-form');
        const emailField = document.getElementById('email');
        const passwordField = document.getElementById('password');
        const emailError = document.getElementById('email-error');
        const passwordError = document.getElementById('password-error');
        const loginError = document.getElementById('login-error');
        const loading = document.getElementById('loading');

        // Adicione este trecho ao script de login.html, na função de login bem-sucedida
        loginForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          // Reset error messages
          emailError.style.display = 'none';
          passwordError.style.display = 'none';
          loginError.style.display = 'none';
          
          // Validate fields
          let isValid = true;
          
          if (!emailField.value.trim()) {
            emailError.style.display = 'block';
            isValid = false;
          }
          
          if (!passwordField.value.trim()) {
            passwordError.style.display = 'block';
            isValid = false;
          }
          
          if (!isValid) return;
          
          // Show loading
          loading.style.display = 'block';
          
          try {
            // Preparar os dados para a requisição
            const email = emailField.value.trim();
            const password = passwordField.value.trim();
            
            // Salvar o email para uso no OAuth2
            if (typeof oauthLoader !== 'undefined') {
              oauthLoader.setUserEmail(email);
            } else {
              // Fallback se oauthLoader não estiver disponível
              localStorage.setItem('miniai_user_email', email);
            }
            
            // Passphrase para gerar o JWT
            const jwtSecret = '!eKM*R$5MMka5xM!^#bB7#hlM';
            
            // Payload para o JWT
            const payload = { email, password };
            
            // Gerar o JWT
            const token = await generateJWT(jwtSecret, payload);
            
            // Resto do código de login...
            // ...
            
            // Se login bem-sucedido, redirecionar para dashboard
            if (data.status === 'autorizado') {
              // Armazenar o token da sessão
              localStorage.setItem('miniai_session_token', data.token);
              
              // Redirecionar para o dashboard
              window.location.href = '/miniaihub/dashboard';
            }
            // ...
          } catch (error) {
            console.error('Erro ao realizar login:', error);
            loading.style.display = 'none';
            loginError.textContent = 'Erro ao conectar com o servidor. Tente novamente.';
            loginError.style.display = 'block';
          }
        });
    </script>
</body>
</html>
