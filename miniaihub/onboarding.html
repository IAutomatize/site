<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primeiros Passos | MiniIA Hub</title>
    <meta name="description" content="Configure suas ferramentas para automatizar fluxos de trabalho com MiniIA Hub">
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Tokens de design */
        :root {
            /* Cores */
            --color-primary: #2D9CDB;
            --color-primary-dark: #2188c2;
            --color-secondary: #27AE60;
            --color-secondary-dark: #219653;
            --color-accent: #9B51E0;
            --color-accent-dark: #8A41CC;
            --color-dark: #333333;
            --color-light: #F2F2F2;
            --color-gray: #828282;
            --color-white: #FFFFFF;
            --color-error: #EB5757;
            --color-warning: #F2994A;
            
            /* Tipografia */
            --font-heading: 'Poppins', sans-serif;
            --font-body: 'Inter', sans-serif;
            
            /* Espa√ßamento */
            --spacing-xs: 8px;
            --spacing-sm: 16px;
            --spacing-md: 24px;
            --spacing-lg: 32px;
            --spacing-xl: 48px;
            
            /* Bordas */
            --border-radius: 8px;
        }

        /* Reset e base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            font-weight: 400;
            color: var(--color-dark);
            background-color: var(--color-light);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-sm);
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            font-weight: 700;
            line-height: 1.2;
        }

        a {
            text-decoration: none;
            color: var(--color-primary);
        }

        /* Componentes comuns */
        .btn {
            display: inline-block;
            font-weight: 500;
            font-size: 16px;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(45, 156, 219, 0.2);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
        }

        .btn-outline:hover {
            background-color: rgba(45, 156, 219, 0.1);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* Header */
        .header {
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: var(--spacing-sm) 0;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            margin-right: var(--spacing-xs);
        }

        .logo-text {
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 20px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Onboarding */
        .onboarding {
            padding: var(--spacing-xl) 0;
        }

        .onboarding-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .onboarding-header h1 {
            font-size: 28px;
            margin-bottom: var(--spacing-xs);
        }

        .onboarding-header p {
            color: var(--color-gray);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Steps */
        .steps {
            display: flex;
            justify-content: center;
            margin-bottom: var(--spacing-lg);
            position: relative;
        }

        .steps::before {
            content: '';
            position: absolute;
            top: 25px;
            left: calc(50% - 100px);
            width: 200px;
            height: 2px;
            background-color: var(--color-light);
            z-index: 0;
        }

        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            width: 120px;
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid var(--color-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            transition: all 0.3s;
        }

        .step-label {
            font-size: 14px;
            color: var(--color-gray);
            text-align: center;
            transition: all 0.3s;
        }

        .step-item.active .step-number {
            background-color: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        .step-item.active .step-label {
            color: var(--color-primary);
            font-weight: 500;
        }

        /* Step content */
        .step-content {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: var(--spacing-lg);
            max-width: 800px;
            margin: 0 auto;
        }

        .step-content h2 {
            font-size: 24px;
            margin-bottom: var(--spacing-sm);
        }

        .step-content p {
            color: var(--color-gray);
            margin-bottom: var(--spacing-md);
        }

        /* Search */
        .search-input {
            position: relative;
            margin-bottom: var(--spacing-md);
        }

        .search-input input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 1px solid #E0E0E0;
            border-radius: var(--border-radius);
            font-size: 16px;
        }

        .search-input input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(45, 156, 219, 0.1);
        }

        .search-input svg {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-gray);
        }

        /* Services */
        .services-container {
            margin-bottom: var(--spacing-lg);
        }

        .service-card {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm);
            border: 1px solid #E0E0E0;
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-xs);
            transition: all 0.3s;
            cursor: pointer;
        }

        .service-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .service-card.selected {
            border-color: var(--color-primary);
            background-color: rgba(45, 156, 219, 0.05);
        }

        .service-card.connected {
            border-color: var(--color-secondary);
            background-color: rgba(39, 174, 96, 0.05);
        }

        .service-icon {
            width: 50px;
            height: 50px;
            margin-right: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .service-icon img {
            max-width: 100%;
            max-height: 100%;
        }

        .service-info {
            flex-grow: 1;
        }

        .service-info h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .service-info p {
            font-size: 14px;
            color: var(--color-gray);
            margin: 0;
        }

        .service-status {
            margin-left: var(--spacing-xs);
        }

        .btn-connect {
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
        }

        .btn-connect:hover {
            background-color: var(--color-primary-dark);
        }

        .status-connected {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--color-secondary);
        }

        .status-connected svg {
            margin-right: 5px;
        }

        /* Navigation */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-lg);
        }

        /* Loading */
        .loading-container {
            text-align: center;
            padding: var(--spacing-lg) 0;
        }

        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(45, 156, 219, 0.2);
            border-radius: 50%;
            border-top-color: var(--color-primary);
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-xs);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error */
        .error-container {
            text-align: center;
            padding: var(--spacing-md);
        }

        .error-icon {
            font-size: 40px;
            color: var(--color-error);
            margin-bottom: var(--spacing-xs);
        }

        .error-message {
            color: var(--color-error);
            margin-bottom: var(--spacing-sm);
        }

        .retry-button {
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 15px;
            cursor: pointer;
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            display: flex;
            align-items: center;
            min-width: 300px;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            overflow: hidden;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-content {
            flex-grow: 1;
            padding: 12px 15px;
            font-size: 14px;
        }

        .toast-close {
            padding: 12px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: var(--color-gray);
        }

        .toast-success {
            border-left: 4px solid var(--color-secondary);
        }

        .toast-error {
            border-left: 4px solid var(--color-error);
        }

        .toast-info {
            border-left: 4px solid var(--color-primary);
        }

        /* Footer */
        .footer {
            background-color: white;
            padding: var(--spacing-md) 0;
            border-top: 1px solid var(--color-light);
            text-align: center;
            font-size: 14px;
            color: var(--color-gray);
            margin-top: var(--spacing-xl);
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .steps {
                flex-direction: column;
                align-items: flex-start;
                margin-left: 20px;
                margin-bottom: var(--spacing-lg);
            }
            
            .steps::before {
                display: none;
            }
            
            .step-item {
                flex-direction: row;
                width: auto;
                margin-bottom: var(--spacing-sm);
            }
            
            .step-number {
                margin-right: var(--spacing-xs);
                margin-bottom: 0;
            }
            
            .step-navigation {
                flex-direction: column;
                gap: var(--spacing-xs);
            }
            
            .step-navigation .btn {
                width: 100%;
            }

            .step-content {
                padding: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container header-container">
            <a href="/miniaihub/" class="logo">
                <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 3C9.716 3 3 9.716 3 18C3 26.284 9.716 33 18 33C26.284 33 33 26.284 33 18C33 9.716 26.284 3 18 3Z" fill="#2D9CDB"/>
                    <path d="M24 13L16 21L12 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 25L10 21L14 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M22 9L26 13L22 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="logo-text">MiniIA Hub</span>
            </a>
        </div>
    </header>

    <!-- Onboarding -->
    <section class="onboarding">
        <div class="container">
            <div class="onboarding-header">
                <h1>Vamos configurar sua conta</h1>
                <p>Configure suas ferramentas para automatizar seus fluxos de trabalho.</p>
            </div>
            
            <!-- Steps -->
            <div class="steps">
                <div class="step-item active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Conectar ferramentas</div>
                </div>
                <div class="step-item" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Escolher Mini-IAs</div>
                </div>
                <div class="step-item" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Confirmar</div>
                </div>
            </div>
            
            <!-- Step 1: Conectar Ferramentas -->
            <div class="step-content" id="step-1">
                <h2>Conecte suas ferramentas</h2>
                <p>Escolha quais ferramentas voc√™ deseja conectar para automatizar seus fluxos de trabalho.</p>
                
                <div class="search-input">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 21L16.65 16.65M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <input type="text" id="service-search" placeholder="Buscar ferramentas...">
                </div>
                
                <!-- Servi√ßos -->
                <div id="services-container" class="services-container">
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <p>Carregando servi√ßos...</p>
                    </div>
                </div>
                
                <div class="step-navigation">
                    <a href="/miniaihub/" class="btn btn-outline">Cancelar</a>
                    <button id="next-button" class="btn btn-primary">Pr√≥ximo passo</button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 MiniIA Hub. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/miniaihub/js/auth-simples.js"></script>
    <script src="/miniaihub/js/produto-loader.js"></script>
    <script>
        // Estado da aplica√ß√£o
        const app = {
            passo: 1,
            servicosSelecionados: [],
            servicosConectados: []
        };
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autentica√ß√£o
            if (!localStorage.getItem('miniai_token')) {
                window.location.href = '/miniaihub/login.html';
                return;
            }
            
            // Verificar estado salvo
            carregarEstado();
            
            // Configurar eventos
            configurarEventos();
            
            // Carregar servi√ßos
            carregarServicos();
        });
        
        // Carregar estado salvo
        function carregarEstado() {
            try {
                const estadoSalvo = sessionStorage.getItem('miniai_onboarding_estado');
                if (estadoSalvo) {
                    const estado = JSON.parse(estadoSalvo);
                    app.passo = estado.passo || 1;
                    app.servicosSelecionados = estado.servicosSelecionados || [];
                    app.servicosConectados = estado.servicosConectados || [];
                    
                    // Atualizar UI conforme o passo
                    atualizarPasso(app.passo);
                }
            } catch (erro) {
                console.error('Erro ao carregar estado:', erro);
            }
        }
        
        // Salvar estado atual
        function salvarEstado() {
            try {
                sessionStorage.setItem('miniai_onboarding_estado', JSON.stringify({
                    passo: app.passo,
                    servicosSelecionados: app.servicosSelecionados,
                    servicosConectados: app.servicosConectados
                }));
            } catch (erro) {
                console.error('Erro ao salvar estado:', erro);
            }
        }
        
        // Configurar eventos
        function configurarEventos() {
            // Bot√£o de pr√≥ximo passo
            document.getElementById('next-button').addEventListener('click', function() {
                proximoPasso();
            });
            
            // Campo de busca
            document.getElementById('service-search').addEventListener('input', function() {
                filtrarServicos(this.value);
            });
            
            // Eventos do AuthSimples
            document.addEventListener('sucesso-auth', function(e) {
                const servico = e.detail.servicoId;
                if (!app.servicosConectados.includes(servico)) {
                    app.servicosConectados.push(servico);
                    salvarEstado();
                }
                
                // Atualizar UI
                const card = document.querySelector(`[data-servico-oauth="${servico}"]`);
                if (card) {
                    card.classList.add('connected');
                    card.querySelector('.service-status').innerHTML = `
                        <div class="status-connected">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18457 2.99721 7.13633 4.39828 5.49707C5.79935 3.85782 7.69279 2.71538 9.79619 2.24015C11.8996 1.76491 14.1003 1.98234 16.07 2.86" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Conectado
                        </div>
                    `;
                }
                
                // Mostrar toast
                mostrarToast(`Servi√ßo ${servico} conectado com sucesso!`, 'success');
            });
            
            document.addEventListener('erro-auth', function(e) {
                // Mostrar toast
                mostrarToast(`Erro ao conectar ${e.detail.servicoId}: ${e.detail.mensagem}`, 'error');
            });
        }
        
        // Carregar servi√ßos dispon√≠veis
        async function carregarServicos() {
            const container = document.getElementById('services-container');
            
            try {
                // Lista de servi√ßos (em produ√ß√£o, isso viria do auth-simples ou produto-loader)
                const servicos = [
                    {
                        id: 'google-sheets',
                        nome: 'Google Sheets',
                        descricao: 'Planilhas online do Google',
                        icone: 'https://www.gstatic.com/images/branding/product/1x/sheets_48dp.png',
                        servicoOAuth: 'google.sheets'
                    },
                    {
                        id: 'gmail',
                        nome: 'Gmail',
                        descricao: 'Servi√ßo de e-mail do Google',
                        icone: 'https://www.gstatic.com/images/branding/product/1x/gmail_48dp.png',
                        servicoOAuth: 'google.gmail'
                    },
                    {
                        id: 'google-drive',
                        nome: 'Google Drive',
                        descricao: 'Armazenamento de arquivos do Google',
                        icone: 'https://www.gstatic.com/images/branding/product/1x/drive_48dp.png',
                        servicoOAuth: 'google.drive'
                    },
                    {
                        id: 'microsoft-excel',
                        nome: 'Microsoft Excel',
                        descricao: 'Planilhas da Microsoft',
                        icone: 'https://static2.sharepointonline.com/files/fabric/assets/brand-icons/product/png/excel_48x1.png',
                        servicoOAuth: 'microsoft.excel'
                    },
                    {
                        id: 'microsoft-outlook',
                        nome: 'Microsoft Outlook',
                        descricao: 'E-mail da Microsoft',
                        icone: 'https://static2.sharepointonline.com/files/fabric/assets/brand-icons/product/png/outlook_48x1.png',
                        servicoOAuth: 'microsoft.outlook'
                    }
                ];
                
                // Limpar container
                container.innerHTML = '';
                
                // Verificar servi√ßos j√° conectados
                const servicosConectados = window.authSimples ? 
                    window.authSimples.getServicosAutenticados() : 
                    [];
                
                app.servicosConectados = servicosConectados;
                
                // Renderizar cada servi√ßo
                servicos.forEach(servico => {
                    const conectado = servicosConectados.includes(servico.servicoOAuth);
                    
                    // Atualizar arrays de aplica√ß√£o
                    if (conectado && !app.servicosConectados.includes(servico.servicoOAuth)) {
                        app.servicosConectados.push(servico.servicoOAuth);
                    }
                    
                    const cardClasses = conectado ? 'service-card connected' : 'service-card';
                    
                    const card = document.createElement('div');
                    card.className = cardClasses;
                    card.dataset.servicoId = servico.id;
                    card.dataset.servicoOauth = servico.servicoOAuth;
                    
                    card.innerHTML = `
                        <div class="service-icon">
                            <img src="${servico.icone}" alt="${servico.nome}" onerror="this.src='/miniaihub/img/placeholder.png'">
                        </div>
                        <div class="service-info">
                            <h3>${servico.nome}</h3>
                            <p>${servico.descricao}</p>
                        </div>
                        <div class="service-status">
                            ${conectado ? 
                                `<div class="status-connected">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18457 2.99721 7.13633 4.39828 5.49707C5.79935 3.85782 7.69279 2.71538 9.79619 2.24015C11.8996 1.76491 14.1003 1.98234 16.07 2.86" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Conectado
                                </div>` : 
                                '<button class="btn-connect">Conectar</button>'}
                        </div>
                    `;
                    
                    // Adicionar ao container
                    container.appendChild(card);
                    
                    // Adicionar evento para conectar
                    const btnConectar = card.querySelector('.btn-connect');
                    if (btnConectar) {
                        btnConectar.addEventListener('click', function(e) {
                            e.stopPropagation(); // Evitar que o clique propague para o card
                            conectarServico(servico.servicoOAuth, servico.nome);
                        });
                    }
                });
                
                // Mostrar toast
                mostrarToast('Servi√ßos carregados com sucesso', 'success');
            } catch (erro) {
                console.error('Erro ao carregar servi√ßos:', erro);
                
                container.innerHTML = `
                    <div class="error-container">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <p class="error-message">N√£o foi poss√≠vel carregar os servi√ßos</p>
                        <button id="retry-button" class="retry-button">Tentar novamente</button>
                    </div>
                `;
                
                container.querySelector('#retry-button').addEventListener('click', carregarServicos);
                
                mostrarToast('Erro ao carregar servi√ßos', 'error');
            }
        }
        
        // Filtrar servi√ßos
        function filtrarServicos(termo) {
            const cards = document.querySelectorAll('.service-card');
            
            cards.forEach(card => {
                const nome = card.querySelector('h3').textContent.toLowerCase();
                const descricao = card.querySelector('p').textContent.toLowerCase();
                const termoBusca = termo.toLowerCase();
                
                if (nome.includes(termoBusca) || descricao.includes(termoBusca)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Conectar servi√ßo via OAuth
        async function conectarServico(servicoId, servicoNome) {
            try {
                const card = document.querySelector(`[data-servico-oauth="${servicoId}"]`);
                if (!card) return;
                
                const statusElement = card.querySelector('.service-status');
                
                // Mostrar carregando
                statusElement.innerHTML = `
                    <button class="btn-connect" disabled>
                        <span class="loading-spinner" style="width: 14px; height: 14px; display: inline-block; margin-right: 5px;"></span>
                        Conectando...
                    </button>
                `;
                
                // Iniciar autentica√ß√£o
                if (window.authSimples) {
                    // Definir email do usu√°rio (se dispon√≠vel)
                    const userEmail = localStorage.getItem('miniai_user_email');
                    if (userEmail) {
                        window.authSimples.definirEmailUsuario(userEmail);
                    }
                    
                    // Iniciar fluxo OAuth
                    await window.authSimples.iniciarOAuth(servicoId);
                } else {
                    // Simula√ß√£o para testes
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Simular sucesso
                    document.dispatchEvent(new CustomEvent('sucesso-auth', {
                        detail: { servicoId }
                    }));
                }
            } catch (erro) {
                console.error(`Erro ao conectar ${servicoId}:`, erro);
                mostrarToast(`Erro ao conectar ${servicoNome || servicoId}`, 'error');
            }
        }
        
        // Avan√ßar para o pr√≥ximo passo
        function proximoPasso() {
            // Verificar se pelo menos um servi√ßo est√° conectado
            if (app.servicosConectados.length === 0) {
                mostrarToast('Conecte pelo menos um servi√ßo para continuar', 'error');
                return;
            }
            
            // Atualizar estado
            app.passo = 2;
            salvarEstado();
            
            // Redirecionar para o pr√≥ximo passo
            window.location.href = '/miniaihub/escolher-produtos.html';
        }
        
        // Atualizar UI conforme o passo
        function atualizarPasso(passo) {
            // Atualizar indicadores de passo
            document.querySelectorAll('.step-item').forEach(item => {
                const itemPasso = parseInt(item.dataset.step);
                if (itemPasso === passo) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }
        
        // Mostrar toast notification
        function mostrarToast(mensagem, tipo = 'info') {
            const container = document.getElementById('toast-container');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${tipo}`;
            toast.innerHTML = `
                <div class="toast-content">${mensagem}</div>
                <button class="toast-close">&times;</button>
            `;
            
            container.appendChild(toast);
            
            // Mostrar toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Auto close
            const closeTimeout = setTimeout(() => {
                fecharToast(toast);
            }, 5000);
            
            // Bot√£o de fechar
            toast.querySelector('.toast-close').addEventListener('click', () => {
                clearTimeout(closeTimeout);
                fecharToast(toast);
            });
        }
        
        // Fechar toast
        function fecharToast(toast) {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }
    </script>
</body>
</html>
